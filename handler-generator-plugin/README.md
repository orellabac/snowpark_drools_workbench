# Handler Generator Plugin

This project implements a maven plugin that processes all the datamodels in a project and generates handlers for them.

To illustrate the usage of this plugin, we will use an example:

Suppose you added a datamodel to your project called `User`:
```
class User {
    String name;
    int age;
    public User(String name, int age) {
        this.name = name;
        this.age = age;
    }
}
```

The handler is called before all the code is compiled.
It will then parse all classes in the project. The parsing will generate an AST (Abstract Syntax Tree) for each class. 

The AST will then be examined to collect the package name, class name, constructor argument names and types. 

This information is then enougth to generate the code for a handler. Most of the handler code is almost the same for all classes, so it is generated by a template.

```
class OutputGeneric_<modelName> {
    public String output;

    public OutputGeneric_" + modelName + "(String output) {
        this.output = output;
    }
}

public class GenericExecutor_{modelName} {
     // ... some code omitted

    public static Class getOutputClass() {
        return OutputGeneric_{modelName}.class;
    }

    public Stream<OutputGeneric_{modelName}> process({argsAndTypes}) {
        String response = apply(new {modelName}( {args}));
        return Stream.of(new OutputGeneric_{modelName}(response));
    }
}
```
As you can see, the data collected after parsing the classes is used to fill the template.

The generated code is then written to a file in the target directory of the project. And will be compiled with the rest of the code.

The generated code is also used to generate the SQL code to create the function in Snowflake.

```sql
 CREATE OR REPLACE FUNCTION DROOLS_{modelName}({argsAndTypes})
 RETURNS TABLE(output VARIANT)
 LANGUAGE JAVA
 RUNTIME_VERSION = '11'
 IMPORTS = ('@rules/drools-utils-0.0.1-FAT.jar','@rules/demo-1.0.jar')\n
 HANDLER = 'GenericExecutor_{mmodelName}'
PACKAGES = ('com.snowflake:snowpark:latest','com.snowflake:telemetry:latest');
````

Notice the imports:
* the first one if the FAT jar with all the drools utils. It is mostly used to add all drools dependencies in one jar.
* the second one is the jar with the generated code.

